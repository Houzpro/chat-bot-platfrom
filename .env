# ============================================================================
# UNIFIED CONFIGURATION FOR RAG CHAT PLATFORM
# ============================================================================
# This is the single source of truth for all microservices configuration.
# All values can be overridden by environment variables in production.
# ============================================================================

# ----------------------------------------------------------------------------
# MICROSERVICES PORTS & URLs
# ----------------------------------------------------------------------------
# Backend Gateway
BACKEND_PORT=8080

# Document Parser Service
DOCUMENT_PARSER_PORT=8081
DOC_PARSER_URL=http://document-parser:8081

# Vector DB Service
VECTOR_DB_PORT=8082
VECTOR_URL=http://vector-db:8082

# AI Service
AI_SERVICE_PORT=8000
AI_URL=http://ai-service:8000

# Frontend
FRONTEND_PORT=3000

# ----------------------------------------------------------------------------
# DATABASE CONFIGURATION
# ----------------------------------------------------------------------------
# PostgreSQL
DATABASE_URL=postgresql://chatbot:chatbot_password@postgres:5432/chatbot?sslmode=disable
JWT_SECRET=your-secret-key-change-in-production-must-be-at-least-32-chars

# ----------------------------------------------------------------------------
# VECTOR DATABASE (Qdrant)
# ----------------------------------------------------------------------------
QDRANT_HOST=qdrant
QDRANT_PORT_REST=6333
QDRANT_PORT_GRPC=6334
QDRANT_COLLECTION_SIZE=768

# ----------------------------------------------------------------------------
# AI MODEL CONFIGURATION
# ----------------------------------------------------------------------------
# GGUF Model Settings
GGUF_MODEL_PATH=./models/qwen3-4b-q4_k_m.gguf
N_THREADS=2
N_CTX=40960

# Generation defaults (optimized for detailed and complete answers)
GEN_MAX_NEW_TOKENS=2048
GEN_TEMPERATURE=0.75
GEN_TOP_P=0.92
GEN_TOP_K=40
GEN_DO_SAMPLE=true
GEN_SYSTEM_BASE_PROMPT=DO NOT use markdown formatting, asterisks, or special symbols. Use plain text only with clear paragraph breaks and natural structure. /no_think
GEN_USER_PROMPT=You are a highly knowledgeable and precise assistant. Provide comprehensive, detailed, and well-structured answers based on the given context. Include all relevant information and explain concepts thoroughly.

# Embeddings Model (multilingual-e5-base: better semantic understanding for Russian/English)
EMBEDDING_MODEL_NAME=intfloat/multilingual-e5-base
EMBEDDING_CACHE_FOLDER=./models/embedding

# Cross-Encoder Reranker (для точного переранжирования результатов поиска)
USE_RERANKER=true
RERANKER_MODEL_NAME=cross-encoder/ms-marco-MiniLM-L-6-v2

# Query Expansion (расширение запроса для лучшего покрытия)
USE_QUERY_EXPANSION=true
QUERY_EXPANSION_COUNT=2

# Contextual Compression (отключено для максимальной полноты контекста)
USE_CONTEXTUAL_COMPRESSION=false

# ----------------------------------------------------------------------------
# RAG CONFIGURATION
# ----------------------------------------------------------------------------
# Retrieval settings (МАКСИМУМ для 100% точности без фильтрации)
RAG_MAX_DOC_CHARS=50000
RAG_MAX_CONTEXT_CHARS=100000
RAG_SCORE_THRESHOLD=0.0
RAG_MAX_RESULTS=60

# Hybrid Search (Vector + BM25 keyword search)
# Увеличен вес BM25 для лучшего keyword matching (особенно для имен, терминов)
USE_HYBRID_SEARCH=true
BM25_WEIGHT=0.35
VECTOR_WEIGHT=0.65

# Document parsing (HUGE chunks for complete hero information)
CHUNK_SIZE=1500
CHUNK_OVERLAP=300

# ----------------------------------------------------------------------------
# DOCUMENT PROCESSING
# ----------------------------------------------------------------------------
MAX_FILE_SIZE=10485760
BODY_LIMIT=52428800

# Supported formats (informational - not used in code)
SUPPORTED_FORMATS=.txt,.pdf,.docx,.json,.csv,.xlsx,.xls,.html,.htm,.md

# ----------------------------------------------------------------------------
# HTTP CLIENT SETTINGS
# ----------------------------------------------------------------------------
HTTP_TIMEOUT_SEC=300
HTTP_RETRY_COUNT=3
HTTP_RETRY_DELAY_MS=1000

# ----------------------------------------------------------------------------
# CORS SETTINGS
# ----------------------------------------------------------------------------
CORS_ALLOW_ORIGINS=*
CORS_ALLOW_METHODS=GET,POST,PUT,DELETE,OPTIONS
CORS_ALLOW_HEADERS=Origin,Content-Type,Accept

# ----------------------------------------------------------------------------
# LOGGING
# ----------------------------------------------------------------------------
LOG_LEVEL=info
# Note: LOG_FORMAT is hardcoded in each service's main.go/main.py
# It uses Go template syntax: [${time}] ${status} - ${method} ${path} (${latency})

# ----------------------------------------------------------------------------
# APPLICATION METADATA
# ----------------------------------------------------------------------------
APP_NAME=RAG Chat Platform
APP_VERSION=1.0.0
ENVIRONMENT=production
